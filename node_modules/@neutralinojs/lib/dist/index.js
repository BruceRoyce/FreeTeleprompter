"use strict";function e(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))}function t(){return f("extensions.getStats")}"function"==typeof SuppressedError&&SuppressedError;var n=Object.freeze({__proto__:null,broadcast:function(e,t){return f("extensions.broadcast",{event:e,data:t})},dispatch:function(n,r,o){return new Promise(((i,s)=>e(this,void 0,void 0,(function*(){const e=yield t();if(e.loaded.includes(n))if(e.connected.includes(n))try{const e=yield f("extensions.dispatch",{extensionId:n,event:r,data:o});i(e)}catch(e){s(e)}else!function(e,t){e in d?d[e].push(t):d[e]=[t]}(n,{method:"extensions.dispatch",data:{extensionId:n,event:r,data:o},resolve:i,reject:s});else s({code:"NE_EX_EXTNOTL",message:`${n} is not loaded`})}))))},getStats:t});function r(e,t){return window.addEventListener(e,t),Promise.resolve({success:!0,message:"Event listener added"})}function o(e,t){const n=new CustomEvent(e,{detail:t});return window.dispatchEvent(n),Promise.resolve({success:!0,message:"Message dispatched"})}function i(e){const t=window.atob(e),n=t.length,r=new Uint8Array(n);for(let e=0;e<n;e++)r[e]=t.charCodeAt(e);return r.buffer}function s(e){let t=new Uint8Array(e),n="";for(let e of t)n+=String.fromCharCode(e);return window.btoa(n)}let a;const c={},u=[],d={};function l(){window.NL_TOKEN&&sessionStorage.setItem("NL_TOKEN",window.NL_TOKEN);const n=w().split(".")[1],s=window.NL_GINJECTED||window.NL_CINJECTED?"127.0.0.1":window.location.hostname;a=new WebSocket(`ws://${s}:${window.NL_PORT}?connectToken=${n}`),function(){if(r("ready",(()=>e(this,void 0,void 0,(function*(){if(yield p(u),!window.NL_EXTENABLED)return;const e=yield t();for(const t of e.connected)o("extensionReady",t)})))),r("extClientConnect",(e=>{o("extensionReady",e.detail)})),!window.NL_EXTENABLED)return;r("extensionReady",(t=>e(this,void 0,void 0,(function*(){t.detail in d&&(yield p(d[t.detail]),delete d[t.detail])}))))}(),function(){a.addEventListener("message",(e=>{var t,n,r;const s=JSON.parse(e.data);s.id&&s.id in c?((null===(t=s.data)||void 0===t?void 0:t.error)?(c[s.id].reject(s.data.error),"NE_RT_INVTOKN"==s.data.error.code&&(a.close(),document.body.innerText="",document.write("<code>NE_RT_INVTOKN</code>: Neutralinojs application cannot execute native methods since <code>NL_TOKEN</code> is invalid."))):(null===(n=s.data)||void 0===n?void 0:n.success)&&c[s.id].resolve(s.data.hasOwnProperty("returnValue")?s.data.returnValue:s.data),delete c[s.id]):s.event&&("openedFile"==s.event&&"dataBinary"==(null===(r=null==s?void 0:s.data)||void 0===r?void 0:r.action)&&(s.data.data=i(s.data.data)),o(s.event,s.data))})),a.addEventListener("open",(t=>e(this,void 0,void 0,(function*(){o("ready")})))),a.addEventListener("close",(t=>e(this,void 0,void 0,(function*(){o("serverOffline",{code:"NE_CL_NSEROFF",message:"Neutralino server is offline. Try restarting the application"})})))),a.addEventListener("error",(t=>e(this,void 0,void 0,(function*(){document.body.innerText="",document.write("<code>NE_CL_IVCTOKN</code>: Neutralinojs application cannot connect with the framework core using <code>NL_TOKEN</code>.")}))))}()}function f(e,t){return new Promise(((n,r)=>{if((null==a?void 0:a.readyState)!=WebSocket.OPEN)return o={method:e,data:t,resolve:n,reject:r},void u.push(o);var o;const i="10000000-1000-4000-8000-100000000000".replace(/[018]/g,(e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))),s=w();c[i]={resolve:n,reject:r},a.send(JSON.stringify({id:i,method:e,data:t,accessToken:s}))}))}function p(t){return e(this,void 0,void 0,(function*(){for(;t.length>0;){const e=t.shift();try{const t=yield f(e.method,e.data);e.resolve(t)}catch(t){e.reject(t)}}}))}function w(){return window.NL_TOKEN||sessionStorage.getItem("NL_TOKEN")||""}function g(e,t){return f("filesystem.writeBinaryFile",{path:e,data:s(t)})}var m=Object.freeze({__proto__:null,appendBinaryFile:function(e,t){return f("filesystem.appendBinaryFile",{path:e,data:s(t)})},appendFile:function(e,t){return f("filesystem.appendFile",{path:e,data:t})},copy:function(e,t,n){return f("filesystem.copy",Object.assign({source:e,destination:t},n))},createDirectory:function(e){return f("filesystem.createDirectory",{path:e})},createWatcher:function(e){return f("filesystem.createWatcher",{path:e})},getAbsolutePath:function(e){return f("filesystem.getAbsolutePath",{path:e})},getOpenedFileInfo:function(e){return f("filesystem.getOpenedFileInfo",{id:e})},getPathParts:function(e){return f("filesystem.getPathParts",{path:e})},getRelativePath:function(e,t){return f("filesystem.getRelativePath",{path:e,base:t})},getStats:function(e){return f("filesystem.getStats",{path:e})},getWatchers:function(){return f("filesystem.getWatchers")},move:function(e,t){return f("filesystem.move",{source:e,destination:t})},openFile:function(e){return f("filesystem.openFile",{path:e})},readBinaryFile:function(e,t){return new Promise(((n,r)=>{f("filesystem.readBinaryFile",Object.assign({path:e},t)).then((e=>{n(i(e))})).catch((e=>{r(e)}))}))},readDirectory:function(e,t){return f("filesystem.readDirectory",Object.assign({path:e},t))},readFile:function(e,t){return f("filesystem.readFile",Object.assign({path:e},t))},remove:function(e){return f("filesystem.remove",{path:e})},removeWatcher:function(e){return f("filesystem.removeWatcher",{id:e})},updateOpenedFile:function(e,t,n){return f("filesystem.updateOpenedFile",{id:e,event:t,data:n})},writeBinaryFile:g,writeFile:function(e,t){return f("filesystem.writeFile",{path:e,data:t})}});function h(e,t){return f("os.execCommand",Object.assign({command:e},t))}var v=Object.freeze({__proto__:null,execCommand:h,getEnv:function(e){return f("os.getEnv",{key:e})},getEnvs:function(){return f("os.getEnvs")},getPath:function(e){return f("os.getPath",{name:e})},getSpawnedProcesses:function(){return f("os.getSpawnedProcesses")},open:function(e){return f("os.open",{url:e})},setTray:function(e){return f("os.setTray",e)},showFolderDialog:function(e,t){return f("os.showFolderDialog",Object.assign({title:e},t))},showMessageBox:function(e,t,n,r){return f("os.showMessageBox",{title:e,content:t,choice:n,icon:r})},showNotification:function(e,t,n){return f("os.showNotification",{title:e,content:t,icon:n})},showOpenDialog:function(e,t){return f("os.showOpenDialog",Object.assign({title:e},t))},showSaveDialog:function(e,t){return f("os.showSaveDialog",Object.assign({title:e},t))},spawnProcess:function(e,t){return f("os.spawnProcess",{command:e,cwd:t})},updateSpawnedProcess:function(e,t,n){return f("os.updateSpawnedProcess",{id:e,event:t,data:n})}});var _=Object.freeze({__proto__:null,getArch:function(){return f("computer.getArch")},getCPUInfo:function(){return f("computer.getCPUInfo")},getDisplays:function(){return f("computer.getDisplays")},getKernelInfo:function(){return f("computer.getKernelInfo")},getMemoryInfo:function(){return f("computer.getMemoryInfo")},getMousePosition:function(){return f("computer.getMousePosition")},getOSInfo:function(){return f("computer.getOSInfo")}});var y=Object.freeze({__proto__:null,getData:function(e){return f("storage.getData",{key:e})},getKeys:function(){return f("storage.getKeys")},setData:function(e,t){return f("storage.setData",{key:e,data:t})}});function b(e,t){return f("debug.log",{message:e,type:t})}var O=Object.freeze({__proto__:null,log:b});function E(e){return f("app.exit",{code:e})}var N=Object.freeze({__proto__:null,broadcast:function(e,t){return f("app.broadcast",{event:e,data:t})},exit:E,getConfig:function(){return f("app.getConfig")},killProcess:function(){return f("app.killProcess")},readProcessInput:function(e){return f("app.readProcessInput",{readAll:e})},restartProcess:function(t){return new Promise((n=>e(this,void 0,void 0,(function*(){let e=window.NL_ARGS.reduce(((e,t)=>(t.includes(" ")&&(t=`"${t}"`),e+=" "+t)),"");(null==t?void 0:t.args)&&(e+=" "+t.args),yield h(e,{background:!0}),E(),n()}))))},writeProcessError:function(e){return f("app.writeProcessError",{data:e})},writeProcessOutput:function(e){return f("app.writeProcessOutput",{data:e})}});const P=new WeakMap;function x(e,t){return f("window.move",{x:e,y:t})}function S(){return f("window.getSize")}var T=Object.freeze({__proto__:null,center:function(){return f("window.center")},create:function(e,t){return new Promise(((n,r)=>{function o(e){return"string"!=typeof e||(e=e.trim()).includes(" ")&&(e=`"${e}"`),e}t=Object.assign(Object.assign({},t),{useSavedState:!1});let i=window.NL_ARGS.reduce(((e,t,n)=>((t.includes("--path=")||t.includes("--debug-mode")||t.includes("--load-dir-res")||0==n)&&(e+=" "+o(t)),e)),"");i+=" --url="+o(e);for(let e in t){if("processArgs"==e)continue;i+=` --window${"-"+e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}=${o(t[e])}`}t&&t.processArgs&&(i+=" "+t.processArgs),h(i,{background:!0}).then((e=>{n(e)})).catch((e=>{r(e)}))}))},exitFullScreen:function(){return f("window.exitFullScreen")},focus:function(){return f("window.focus")},getPosition:function(){return f("window.getPosition")},getSize:S,getTitle:function(){return f("window.getTitle")},hide:function(){return f("window.hide")},isFullScreen:function(){return f("window.isFullScreen")},isMaximized:function(){return f("window.isMaximized")},isMinimized:function(){return f("window.isMinimized")},isVisible:function(){return f("window.isVisible")},maximize:function(){return f("window.maximize")},minimize:function(){return f("window.minimize")},move:x,setAlwaysOnTop:function(e){return f("window.setAlwaysOnTop",{onTop:e})},setDraggableRegion:function(t,n={}){return new Promise(((r,o)=>{const i=t instanceof Element?t:document.getElementById(t);let s=0,a=0,c=0,u=!1,d=performance.now(),l=n.alwaysCapture;if(!i)return o({code:"NE_WD_DOMNOTF",message:"Unable to find DOM element"});if(P.has(i))return o({code:"NE_WD_ALRDREL",message:"This DOM element is already an active draggable region"});function f(t){return e(this,void 0,void 0,(function*(){var e;const r=t.clientX-s,o=t.clientY-a;if(c=Math.sqrt(r*r+o*o),c>=(null!==(e=n.dragMinDistance)&&void 0!==e?e:10)&&(u=!0,l||(i.setPointerCapture(t.pointerId),l=!0)),u){const e=performance.now(),n=e-d;if(n<5)return;return d=e-(n-5),void(yield x(t.screenX-s,t.screenY-a))}}))}function p(e){0===e.button&&(s=e.clientX,a=e.clientY,i.addEventListener("pointermove",f),n.alwaysCapture&&i.setPointerCapture(e.pointerId))}function w(e){i.removeEventListener("pointermove",f),i.releasePointerCapture(e.pointerId)}i.addEventListener("pointerdown",p),i.addEventListener("pointerup",w),i.addEventListener("pointercancel",w),P.set(i,{pointerdown:p,pointerup:w}),r({success:!0,message:"Draggable region was activated"})}))},setFullScreen:function(){return f("window.setFullScreen")},setIcon:function(e){return f("window.setIcon",{icon:e})},setSize:function(t){return new Promise(((n,r)=>e(this,void 0,void 0,(function*(){let e=yield S();f("window.setSize",t=Object.assign(Object.assign({},e),t)).then((e=>{n(e)})).catch((e=>{r(e)}))}))))},setTitle:function(e){return f("window.setTitle",{title:e})},show:function(){return f("window.show")},snapshot:function(e){return f("window.snapshot",{path:e})},unmaximize:function(){return f("window.unmaximize")},unminimize:function(){return f("window.unminimize")},unsetDraggableRegion:function(e){return new Promise(((t,n)=>{const r=e instanceof Element?e:document.getElementById(e);if(!r)return n({code:"NE_WD_DOMNOTF",message:"Unable to find DOM element"});if(!P.has(r))return n({code:"NE_WD_NOTDRRE",message:"DOM element is not an active draggable region"});const{pointerdown:o,pointerup:i}=P.get(r);r.removeEventListener("pointerdown",o),r.removeEventListener("pointerup",i),r.removeEventListener("pointercancel",i),P.delete(r),t({success:!0,message:"Draggable region was deactivated"})}))}});var D=Object.freeze({__proto__:null,broadcast:function(e,t){return f("events.broadcast",{event:e,data:t})},dispatch:o,off:function(e,t){return window.removeEventListener(e,t),Promise.resolve({success:!0,message:"Event listener removed"})},on:r});let L=null;var F=Object.freeze({__proto__:null,checkForUpdates:function(t){return new Promise(((n,r)=>e(this,void 0,void 0,(function*(){if(!t)return r({code:"NE_RT_NATRTER",message:"Missing require parameter: url"});try{const e=yield fetch(t);L=JSON.parse(yield e.text()),!function(e){return!!(e.applicationId&&e.applicationId==window.NL_APPID&&e.version&&e.resourcesURL)}(L)?r({code:"NE_UP_CUPDMER",message:"Invalid update manifest or mismatching applicationId"}):n(L)}catch(e){r({code:"NE_UP_CUPDERR",message:"Unable to fetch update manifest"})}}))))},install:function(){return new Promise(((t,n)=>e(this,void 0,void 0,(function*(){if(!L)return n({code:"NE_UP_UPDNOUF",message:"No update manifest loaded"});try{const e=yield fetch(L.resourcesURL),n=yield e.arrayBuffer();yield g(window.NL_PATH+"/resources.neu",n),t({success:!0,message:"Update installed. Restart the process to see updates"})}catch(e){n({code:"NE_UP_UPDINER",message:"Update installation error"})}}))))}});var j=Object.freeze({__proto__:null,clear:function(){return f("clipboard.clear")},getFormat:function(){return f("clipboard.getFormat")},readImage:function(e=""){return new Promise(((t,n)=>{f("clipboard.readImage").then((n=>{if(n){const r=window.atob(n.data);let o,i,s,a=32==n.bpp?4:3;switch(e.toLowerCase()){case"rgb":o=n.width*n.height*3,i=[0,1,2];break;case"rgba":o=n.width*n.height*4,i=[0,1,2,3];break;case"argb":o=n.width*n.height*4,i=[3,0,1,2];break;case"bgra":o=n.width*n.height*4,i=[2,1,0,3];break;default:o=r.length,s=new Uint8Array(o);for(let e=0;e<o;e++)s[e]=r.charCodeAt(e);return n.data=s,void t(n)}s=new Uint8Array(o);let c,u,d,l,f,p=255==new Uint8Array(new Uint32Array([255]).buffer)[0],w=[],g=0;for(let e=0;e<r.length;e+=a)c=r.charCodeAt(e),u=r.charCodeAt(e+1),d=r.charCodeAt(e+2),l=4==a?r.charCodeAt(e+3):255,f=p?(l<<24|d<<16|u<<8|c)>>>0:(c<<24|u<<16|d<<8|l)>>>0,w=[f>>n.redShift&255,f>>n.greenShift&255,f>>n.blueShift&255,f>>n.alphaShift&255],i.forEach(((e,t)=>{s[t+g]=w[e]})),g+=i.length;n.data=s}t(n)})).catch((e=>{n(e)}))}))},readText:function(){return f("clipboard.readText")},writeImage:function(e){const t=Object.assign({},e);return(null==e?void 0:e.data)&&(t.data=s(e.data)),f("clipboard.writeImage",t)},writeText:function(e){return f("clipboard.writeText",{data:e})}});var C=Object.freeze({__proto__:null,extractDirectory:function(e,t){return f("resources.extractDirectory",{path:e,destination:t})},extractFile:function(e,t){return f("resources.extractFile",{path:e,destination:t})},getFiles:function(){return f("resources.getFiles")},getStats:function(e){return f("resources.getStats",{path:e})},readBinaryFile:function(e){return new Promise(((t,n)=>{f("resources.readBinaryFile",{path:e}).then((e=>{t(i(e))})).catch((e=>{n(e)}))}))},readFile:function(e){return f("resources.readFile",{path:e})}});var I=Object.freeze({__proto__:null,getMounts:function(){return f("server.getMounts")},mount:function(e,t){return f("server.mount",{path:e,target:t})},unmount:function(e){return f("server.unmount",{path:e})}});var A=Object.freeze({__proto__:null,getMethods:function(){return f("custom.getMethods")}});let M=!1;exports.app=N,exports.clipboard=j,exports.computer=_,exports.custom=A,exports.debug=O,exports.events=D,exports.extensions=n,exports.filesystem=m,exports.init=function(t={}){if(t=Object.assign({exportCustomMethods:!0},t),!M){if(l(),window.NL_ARGS.find((e=>"--neu-dev-auto-reload"==e))&&r("neuDev_reloadApp",(()=>e(this,void 0,void 0,(function*(){yield b("Reloading the application..."),location.reload()})))),t.exportCustomMethods&&window.NL_CMETHODS&&window.NL_CMETHODS.length>0)for(const e of window.NL_CMETHODS)Neutralino.custom[e]=(...t)=>{let n={};for(const[e,r]of t.entries())n="object"!=typeof r||Array.isArray(r)||null==r?Object.assign(Object.assign({},n),{["arg"+e]:r}):Object.assign(Object.assign({},n),r);return f("custom."+e,n)};window.NL_CVERSION="5.6.0",window.NL_CCOMMIT="425c526c318342e0e5d0f17caceef2a53049eda4",M=!0}},exports.os=v,exports.resources=C,exports.server=I,exports.storage=y,exports.updater=F,exports.window=T;
